<!DOCTYPE html>

<html>
<head>
  <title>Tonal</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          
          <h1 id="tonal">Tonal</h1>

          
        

        
      </div>

      
        
        <p><strong>tonal</strong> is a functional music theory library. It deals with abstract music
concepts like picthes and intervals, not actual music.</p>

        
      
        
        <p><code>tonal</code> is also the result of my journey of learning how to implement a music
theory library in javascript in a functional way.</p>

        
      
        
        <p>You are currently reading the source code of the library. It’s written in
<a href="https://en.wikipedia.org/wiki/Literate_programming">literate programming</a> as
a tribute to the The Haskell School of Music and it’s impressive book/source
code <a href="http://haskell.cs.yale.edu/wp-content/uploads/2015/03/HSoM.pdf">“From Signals to
Symphonies”</a>
that has a big influence over tonal development.</p>

        
      
        
        <p>This page is generated using the documentation tool
<a href="http://jashkenas.github.io/docco/">docco</a></p>

        
      
        
        <h4 id="prelude">Prelude</h4>

        
      
        
        <p>Parse note names with <code>note-parser</code></p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> noteParse = <span class="hljs-built_in">require</span>(<span class="hljs-string">'note-parser'</span>).parse</pre></div>
        
      
        
        <p>Parse interval names with <code>interval-notation</code></p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> ivlNttn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'interval-notation'</span>)</pre></div>
        
      
        
        <p>Utilities</p>

        
      
        
        <p>Is an array?</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isArr = <span class="hljs-built_in">Array</span>.isArray</pre></div>
        
      
        
        <p>Is a number?</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isNum = (n) =&gt; <span class="hljs-keyword">typeof</span> n === <span class="hljs-string">'number'</span></pre></div>
        
      
        
        <p>Is string?</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isStr = (o) =&gt; <span class="hljs-keyword">typeof</span> o === <span class="hljs-string">'string'</span></pre></div>
        
      
        
        <p>Is defined? (can be null)</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isDef = (o) =&gt; <span class="hljs-keyword">typeof</span> o !== <span class="hljs-string">'undefined'</span></pre></div>
        
      
        
        <p>Is a value?</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isValue = (v) =&gt; v !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> v !== <span class="hljs-string">'undefined'</span></pre></div>
        
      
        
        <p><strong>Functional helpers</strong></p>

        
      
        
        <p>Identity function</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> id = (x) =&gt; x</pre></div>
        
      
        
        <h2 id="1-pitches">1. Pitches</h2>

        
      
        
        <p>An array with the signature: <code>[&#39;tnl&#39;, fifths, octaves, direction]</code>:</p>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Create a pitch class in array notation
 *
 * @param {Integer} fifhts - the number of fifths from C
 * @return {Pitch} the pitch in array notation
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> pcArr = (f) =&gt; [<span class="hljs-string">'tnl'</span>, f]

<span class="hljs-comment">/**
 * Create a note pitch in array notation
 *
 * @param {Integer} fifhts - the number of fifths from C
 * @param {Integer} octaves - the number of encoded octaves
 * @return {Pitch} the pitch in array notation
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> noteArr = (f, o) =&gt; [<span class="hljs-string">'tnl'</span>, f, o]</pre></div>
        
      
        
        <p>calculate interval direction</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> calcDir = (f, o) =&gt; encDir(<span class="hljs-number">7</span> * f + <span class="hljs-number">12</span> * o)

<span class="hljs-comment">/**
 * Create an interval in array notation
 *
 * @param {Integer} fifhts - the number of fifths from C
 * @param {Integer} octaves - the number of encoded octaves
 * @param {Integer} dir - (Optional) the direction
 * @return {Pitch} the pitch in array notation
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ivlArr = (f, o, d) =&gt; [<span class="hljs-string">'tnl'</span>, f, o, d || calcDir(f, o) ]

<span class="hljs-comment">/**
 * Test if a given object is a pitch
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isPitch = (p) =&gt; p &amp;&amp; p[<span class="hljs-number">0</span>] === <span class="hljs-string">'tnl'</span>
<span class="hljs-comment">/**
 * Test if a given object is a pitch class
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isPitchClass = (p) =&gt; isPitch(p) &amp;&amp; p.length === <span class="hljs-number">2</span>
<span class="hljs-comment">/**
 * Test if a given object is a pitch with octave (note pitch or interval)
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> hasOct = (p) =&gt; isPitch(p) &amp;&amp; isNum(p[<span class="hljs-number">2</span>])
<span class="hljs-comment">/**
 * Test if a given object is a note pitch
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isNotePitch = (p) =&gt; hasOct(p) &amp;&amp; p.length === <span class="hljs-number">3</span>
<span class="hljs-comment">/**
 * Test if a given object is a pitch interval
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isInterval = (i) =&gt; hasOct(i) &amp;&amp; isNum(i[<span class="hljs-number">3</span>])
<span class="hljs-comment">/**
 * Test if a given object is a pitch, but not an interval
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isPitchNotIvl = (i) =&gt; isPitch(i) &amp;&amp; !isDef(i[<span class="hljs-number">3</span>])</pre></div>
        
      
        
        <h4 id="pitch-encoding">Pitch encoding</h4>

        
      
        
        <p>Map from letter step to number of fifths and octaves
equivalent to: { C: 0, D: 2, E: 4, F: -1, G: 1, A: 3, B: 5 }</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> FIFTHS = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]</pre></div>
        
      
        
        <p>Encode a pitch class using the step number and alteration</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> encPC = (step, alt) =&gt; FIFTHS[step] + <span class="hljs-number">7</span> * alt</pre></div>
        
      
        
        <p>Given a number of fifths, return the octaves they span</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> fOcts = (f) =&gt; <span class="hljs-built_in">Math</span>.floor(f * <span class="hljs-number">7</span> / <span class="hljs-number">12</span>)</pre></div>
        
      
        
        <p>Get the number of octaves it span each step</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> FIFTH_OCTS = FIFTHS.map(fOcts)</pre></div>
        
      
        
        <p>Encode octaves</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> encOct = (step, alt, oct) =&gt; oct - FIFTH_OCTS[step] - <span class="hljs-number">4</span> * alt</pre></div>
        
      
        
        <p>Encode direction</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> encDir = (n) =&gt; n &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>

<span class="hljs-comment">/**
 * Create a pitch. A pitch in tonal may refer to a pitch class, the pitch
 * of a note or an interval.
 *
 * @param {Integer} step - an integer from 0 to 6 representing letters
 * from C to B or simple interval numbers from unison to seventh
 * @param {Integer} alt - the alteration
 * @param {Integer} oct - the pitch octave
 * @param {Integer} dir - (Optional, intervals only) The interval direction
 * @return {Pitch} the pitch encoded as array notation
 *
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span> (<span class="hljs-params">step, alt, oct, dir</span>) </span>{</pre></div>
        
      
        
        <p>is valid step?</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">if</span> (step &lt; <span class="hljs-number">0</span> || step &gt; <span class="hljs-number">6</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> pc = encPC(step, alt || <span class="hljs-number">0</span>)</pre></div>
        
      
        
        <p>if not octave, return the pitch class</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!isNum(oct)) <span class="hljs-keyword">return</span> pcArr(pc)

  <span class="hljs-keyword">const</span> o = encOct(step, alt, oct)</pre></div>
        
      
        
        <p>if not direction, return a note pitch</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!isNum(dir)) <span class="hljs-keyword">return</span> noteArr(pc, o)

  <span class="hljs-keyword">const</span> d = encDir(dir)</pre></div>
        
      
        
        <p>return the interval</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">return</span> ivlArr(d * pc, d * o, d)
}</pre></div>
        
      
        
        <h3 id="pitch-decoding">Pitch decoding</h3>

        
      
        
        <p>remove accidentals to a pitch class
it gets an array and return a number of fifths</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unaltered</span> (<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">const</span> i = (f + <span class="hljs-number">1</span>) % <span class="hljs-number">7</span>
  <span class="hljs-keyword">return</span> i &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">7</span> + i : i
}

<span class="hljs-keyword">const</span> decodeStep = (f) =&gt; STEPS[unaltered(f)]
<span class="hljs-keyword">const</span> decodeAlt = (f) =&gt; <span class="hljs-built_in">Math</span>.floor((f + <span class="hljs-number">1</span>) / <span class="hljs-number">7</span>)</pre></div>
        
      
        
        <p>‘FCGDAEB’ steps numbers</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> STEPS = [<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>]
<span class="hljs-comment">/**
 * Decode a pitch to its numeric properties
 * @param {Pitch}
 * @return {Object}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span> (<span class="hljs-params">p</span>) </span>{
  <span class="hljs-keyword">const</span> s = decodeStep(p[<span class="hljs-number">1</span>])
  <span class="hljs-keyword">const</span> a = decodeAlt(p[<span class="hljs-number">1</span>])
  <span class="hljs-keyword">const</span> o = isNum(p[<span class="hljs-number">2</span>]) ? p[<span class="hljs-number">2</span>] + <span class="hljs-number">4</span> * a + FIFTH_OCTS[s] : <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> { step: s, alt: a, oct: o, dir: p[<span class="hljs-number">3</span>] || <span class="hljs-literal">null</span> }
}</pre></div>
        
      
        
        <h4 id="pitch-parsers">Pitch parsers</h4>

        
      
        
        <p>Convert from string to pitches is a quite expensive operation that it’s
executed a lot of times. Some caching will help:</p>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">const</span> cached = (parser) =&gt; {
  <span class="hljs-keyword">const</span> cache = {}
  <span class="hljs-keyword">return</span> (str) =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str !== <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> cache[str] || (cache[str] = parser(str))
  }
}

<span class="hljs-comment">/**
 * Parse a note name
 * @param {String}
 * @return {Pitch}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parseNote = cached((str) =&gt; {
  <span class="hljs-keyword">const</span> n = noteParse(str)
  <span class="hljs-keyword">return</span> n ? encode(n.step, n.alt, n.oct) : <span class="hljs-literal">null</span>
})

<span class="hljs-comment">/**
 * Test if the given string is a note name
 * @param {String}
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isNoteStr = (s) =&gt; parseNote(s) !== <span class="hljs-literal">null</span>

<span class="hljs-comment">/**
 * Parses an interval name in shorthand notation
 * @param {String}
 * @return {Pitch}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parseIvl = cached((str) =&gt; {
  <span class="hljs-keyword">const</span> i = ivlNttn.parse(str)
  <span class="hljs-keyword">return</span> i ? encode(i.simple - <span class="hljs-number">1</span>, i.alt, i.oct, i.dir) : <span class="hljs-literal">null</span>
})

<span class="hljs-comment">/**
 * Test if the given string is an interval name
 * @param {String}
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isIntervalStr = (s) =&gt; parseIvl(s) !== <span class="hljs-literal">null</span>


<span class="hljs-keyword">const</span> parsePitch = (str) =&gt; parseNote(str) || parseIvl(str)</pre></div>
        
      
        
        <h3 id="pitch-to-string">Pitch to string</h3>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Given a step number return the letter
 * @param {Integer}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> toLetter = (s) =&gt; <span class="hljs-string">'CDEFGAB'</span>[s % <span class="hljs-number">7</span>]</pre></div>
        
      
        
        <p>Repeat a string num times</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> fillStr = (s, num) =&gt; <span class="hljs-built_in">Array</span>(<span class="hljs-built_in">Math</span>.abs(num) + <span class="hljs-number">1</span>).join(s)

<span class="hljs-comment">/**
 * Given an alteration number, return the accidentals
 *
 * @param {Integer}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> toAcc = (n) =&gt; fillStr(n &lt; <span class="hljs-number">0</span> ? <span class="hljs-string">'b'</span> : <span class="hljs-string">'#'</span>, n)
<span class="hljs-keyword">const</span> strNum = (n) =&gt; n !== <span class="hljs-literal">null</span> ? n : <span class="hljs-string">''</span>

<span class="hljs-comment">/**
 * Given a pitch class or a pitch note, get the string in scientific
 * notation
 *
 * @param {Pitch}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">strNote</span> (<span class="hljs-params">n</span>) </span>{
  <span class="hljs-keyword">const</span> p = isPitch(n) &amp;&amp; !n[<span class="hljs-number">3</span>] ? decode(n) : <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> p ? toLetter(p.step) + toAcc(p.alt) + strNum(p.oct) : <span class="hljs-literal">null</span>
}</pre></div>
        
      
        
        <p>is an interval ascending?</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> isAsc = (p) =&gt; p.dir === <span class="hljs-number">1</span></pre></div>
        
      
        
        <p>is an interval perfectable?</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> isPerf = (p) =&gt; ivlNttn.type(p.step + <span class="hljs-number">1</span>) === <span class="hljs-string">'P'</span></pre></div>
        
      
        
        <p>calculate interval number</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> calcNum = (p) =&gt; isAsc(p) ? p.step + <span class="hljs-number">1</span> + <span class="hljs-number">7</span> * p.oct : (<span class="hljs-number">8</span> - p.step) - <span class="hljs-number">7</span> * (p.oct + <span class="hljs-number">1</span>)</pre></div>
        
      
        
        <p>calculate interval alteration</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> calcAlt = (p) =&gt; isAsc(p) ? p.alt : isPerf(p) ? -p.alt : -(p.alt + <span class="hljs-number">1</span>)

<span class="hljs-comment">/**
 * Given an interval, get the string in scientific
 * notation
 *
 * @param {Pitch}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">strIvl</span> (<span class="hljs-params">pitch</span>) </span>{
  <span class="hljs-keyword">const</span> p = isInterval(pitch) ? decode(pitch) : <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (!p) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">const</span> num = calcNum(p)
  <span class="hljs-keyword">return</span> p.dir * num + ivlNttn.altToQ(num, calcAlt(p))
}

<span class="hljs-keyword">const</span> strPitch = (p) =&gt; p[<span class="hljs-number">3</span>] ? strIvl(p) : strNote(p)</pre></div>
        
      
        
        <h4 id="decorate-pitch-transform-functions">Decorate pitch transform functions</h4>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">const</span> notation = (parse, str) =&gt; (v) =&gt; !isPitch(v) ? parse(v) : str(v)

<span class="hljs-keyword">const</span> asNote = notation(parseNote, id)
<span class="hljs-keyword">const</span> asIvl = notation(parseIvl, id)
<span class="hljs-keyword">const</span> asPitch = notation(parsePitch, id)

<span class="hljs-keyword">const</span> toNoteStr = notation(id, strNote)
<span class="hljs-keyword">const</span> toIvlStr = notation(id, strIvl)
<span class="hljs-keyword">const</span> toPitchStr = notation(id, strPitch)</pre></div>
        
      
        
        <p>create a function decorator to work with pitches</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> pitchOp = (parse, to) =&gt; (fn) =&gt; (v) =&gt; {</pre></div>
        
      
        
        <p>is value in array notation?…</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">const</span> isP = isPitch(v)</pre></div>
        
      
        
        <p>then no transformation is required</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">if</span> (isP) <span class="hljs-keyword">return</span> fn(v)</pre></div>
        
      
        
        <p>else parse the pitch</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">const</span> p = parse(v)</pre></div>
        
      
        
        <p>if parsed, apply function and back to string</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">return</span> p ? to(fn(p)) : <span class="hljs-literal">null</span>
}
<span class="hljs-keyword">const</span> noteFn = pitchOp(parseNote, toNoteStr)
<span class="hljs-keyword">const</span> ivlFn = pitchOp(parseIvl, toIvlStr)
<span class="hljs-keyword">const</span> pitchFn = pitchOp(parsePitch, toPitchStr)

<span class="hljs-comment">/**
 * Given a string return a note string in scientific notation or null
 * if not valid string
 *
 * @param {String}
 * @return {String}
 * @example
 * ['c', 'db3', '2', 'g+', 'gx4'].map(tonal.note)
 * // =&gt; ['C', 'Db3', null, null, 'G##4']
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> note = noteFn(id)</pre></div>
        
      
        
        <h4 id="pitch-properties">Pitch properties</h4>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Get pitch class of a note. The note can be a string or a pitch array.
 *
 * @param {String|Pitch}
 * @return {String} the pitch class
 * @example
 * tonal.pc('Db3') // =&gt; 'Db'
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> pc = noteFn((p) =&gt; [ <span class="hljs-string">'tnl'</span>, p[<span class="hljs-number">1</span>] ])

<span class="hljs-comment">/**
 * Return the chroma of a pitch.
 *
 * @param {String|Pitch}
 * @return {Integer}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> chroma = pitchFn((n) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-number">7</span> * n[<span class="hljs-number">1</span>] - <span class="hljs-number">12</span> * fOcts(n[<span class="hljs-number">1</span>])
})

<span class="hljs-comment">/**
 * Return the letter of a pitch
 *
 * @param {String|Pitch}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> letter = noteFn((n) =&gt; toLetter(decode(n).step))

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> accidentals = noteFn((n) =&gt; toAcc(decode(n).alt))

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> octave = pitchFn((p) =&gt; decode(p).oct)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> simplify = ivlFn(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i</span>) </span>{
  <span class="hljs-keyword">const</span> d = i[<span class="hljs-number">3</span>]
  <span class="hljs-keyword">const</span> s = decodeStep(d * i[<span class="hljs-number">1</span>])
  <span class="hljs-keyword">const</span> a = decodeAlt(d * i[<span class="hljs-number">1</span>])
  <span class="hljs-keyword">return</span> ivlArr(i[<span class="hljs-number">1</span>], -d * (FIFTH_OCTS[s] + <span class="hljs-number">4</span> * a), d)
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> simplifyAsc = ivlFn((i) =&gt; {
  <span class="hljs-keyword">var</span> s = simplify(i)
  <span class="hljs-keyword">return</span> (s[<span class="hljs-number">3</span>] === <span class="hljs-number">1</span>) ? s : ivlArr(s[<span class="hljs-number">1</span>], s[<span class="hljs-number">2</span>] + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> simpleNum = ivlFn(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i</span>) </span>{
  <span class="hljs-keyword">const</span> p = decode(i)
  <span class="hljs-keyword">return</span> p.step + <span class="hljs-number">1</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> number = ivlFn((i) =&gt; calcNum(decode(i)))

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> quality = ivlFn((i) =&gt; {
  <span class="hljs-keyword">const</span> p = decode(i)
  <span class="hljs-keyword">return</span> ivlNttn.altToQ(p.step + <span class="hljs-number">1</span>, p.alt)
})</pre></div>
        
      
        
        <p><strong>semitones</strong></p>

        
      
        
        <p>get pitch height</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> height = (p) =&gt; p[<span class="hljs-number">1</span>] * <span class="hljs-number">7</span> + <span class="hljs-number">12</span> * p[<span class="hljs-number">2</span>]
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> semitones = ivlFn(height)</pre></div>
        
      
        
        <h4 id="midi-pitch-numbers">Midi pitch numbers</h4>

        
      
        
        <p>The midi note number can have a value between 0-127
<a href="http://www.midikits.net/midi_analyser/midi_note_numbers_for_octaves.htm">http://www.midikits.net/midi_analyser/midi_note_numbers_for_octaves.htm</a></p>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Test if the given number is a valid midi note number
 * @function
 * @param {Object} num - the number to test
 * @return {Boolean} true if it's a valid midi note number
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isMidi = (m) =&gt; isValue(m) &amp;&amp; !isArr(m) &amp;&amp; m &gt;= <span class="hljs-number">0</span> &amp;&amp; m &lt; <span class="hljs-number">128</span></pre></div>
        
      
        
        <p>To match the general midi specification where <code>C4</code> is 60 we must add 12 to
<code>height</code> function:</p>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Get midi number for a pitch
 * @function
 * @param {Array|String} pitch - the pitch
 * @return {Integer} the midi number or null if not valid pitch
 * @example
 * midi('C4') // =&gt; 60
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> midi = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
  <span class="hljs-keyword">const</span> p = asNote(val)
  <span class="hljs-keyword">return</span> hasOct(p) ? height(p) + <span class="hljs-number">12</span>
    : isMidi(val) ? +val
    : <span class="hljs-literal">null</span>
}

<span class="hljs-keyword">const</span> PCS = <span class="hljs-string">'C Db D Eb E F Gb G Ab A Bb B'</span>.split(<span class="hljs-string">' '</span>)
<span class="hljs-comment">/**
 * Given a midi number, returns a note name. The altered notes will have
 * flats.
 * @param {Integer} midi - the midi note number
 * @return {String} the note name
 * @example
 * tonal.fromMidi(61) // =&gt; 'Db4'
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fromMidi = (m) =&gt; {
  <span class="hljs-keyword">const</span> pc = PCS[m % <span class="hljs-number">12</span>]
  <span class="hljs-keyword">const</span> o = <span class="hljs-built_in">Math</span>.floor(m / <span class="hljs-number">12</span>) - <span class="hljs-number">1</span>
  <span class="hljs-keyword">return</span> pc + o
}</pre></div>
        
      
        
        <h4 id="frequency-conversions">Frequency conversions</h4>

        
      
        
        <p>The most popular way (in western music) to calculate the frequency of a pitch
is using the <a href="https://en.wikipedia.org/wiki/Well_temperament">well
temperament</a> tempered tuning.
It assumes the octave to be divided in 12 equally sized semitones and tune
all the notes against a reference:</p>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Get a frequency calculator function that uses well temperament and a tuning reference.
 * @function
 * @param {Float} ref - the tuning reference
 * @return {Function} the frequency calculator. It accepts a pitch in array or scientific notation and returns the frequency in herzs.
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> wellTempered = (ref) =&gt; (pitch) =&gt; {
  <span class="hljs-keyword">const</span> m = midi(pitch)
  <span class="hljs-keyword">return</span> m ? <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>, (m - <span class="hljs-number">69</span>) / <span class="hljs-number">12</span>) * ref : <span class="hljs-literal">null</span>
}</pre></div>
        
      
        
        <p>The common tuning reference is <code>A4 = 440Hz</code>:</p>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Get the frequency of a pitch using well temperament scale and A4 equal to 440Hz
 * @function
 * @param {Array|String} pitch - the pitch to get the frequency from
 * @return {Float} the frequency in herzs
 * @example
 * tonal.freq('C4') // =&gt; 261.6255653005986
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> freq = wellTempered(<span class="hljs-number">440</span>)</pre></div>
        
      
        
        <h1 id="2-pitch-distances">2. PITCH DISTANCES</h1>

        
      
        
        
        
      
        
        <h3 id="2-1-tansposition">2.1 Tansposition</h3>

        
          <div class='highlight'><pre>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trBy</span> (<span class="hljs-params">i, p</span>) </span>{
  <span class="hljs-keyword">if</span> (p === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">const</span> f = i[<span class="hljs-number">1</span>] + p[<span class="hljs-number">1</span>]
  <span class="hljs-keyword">if</span> (p.length === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> [ <span class="hljs-string">'tnl'</span>, f ]
  <span class="hljs-keyword">const</span> o = i[<span class="hljs-number">2</span>] + p[<span class="hljs-number">2</span>]
  <span class="hljs-keyword">if</span> (p.length === <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> [ <span class="hljs-string">'tnl'</span>, f, o ]
  <span class="hljs-keyword">return</span> [ <span class="hljs-string">'tnl'</span>, f, o, calcDir(f, o) ]
}

<span class="hljs-comment">/**
 * Transpose notes. Can be used to add intervals
 * @function
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">transpose</span> (<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> (b) =&gt; transpose(a, b)
  <span class="hljs-keyword">const</span> pa = asPitch(a)
  <span class="hljs-keyword">const</span> pb = asPitch(b)
  <span class="hljs-keyword">const</span> r = isInterval(pa) ? trBy(pa, pb)
    : isInterval(pb) ? trBy(pb, pa) : <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> toPitchStr(r)
}

<span class="hljs-comment">/**
 * Transpose notes. An alias for `transpose`
 * @function
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> tr = transpose</pre></div>
        
      
        
        <h3 id="2-2-distances-in-intervals-">2.2 Distances (in intervals)</h3>

        
      
        
        <p>substract two pitches</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">substr</span> (<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-keyword">if</span> (a.length !== b.length) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> isPitchClass(a)
    ? ivlArr(b[<span class="hljs-number">1</span>] - a[<span class="hljs-number">1</span>], -fOcts(b[<span class="hljs-number">1</span>] - a[<span class="hljs-number">1</span>]), <span class="hljs-number">1</span>)
    : ivlArr(b[<span class="hljs-number">1</span>] - a[<span class="hljs-number">1</span>], b[<span class="hljs-number">2</span>] - a[<span class="hljs-number">2</span>])
}

<span class="hljs-comment">/**
 * Find distance between two pitches. Both pitches MUST be of the same type.
 * Distances between pitch classes always returns ascending intervals.
 * Distances between intervals substract one from the other.
 *
 * @param {Pitch|String} from - distance from
 * @param {Pitch|String} to - distance to
 * @return {Interval} the distance between pitches
 * @example
 * var tonal = require('tonal')
 * tonal.distance('C2', 'C3') // =&gt; 'P8'
 * tonal.distance('G', 'B') // =&gt; 'M3'
 * tonal.distance('M2', 'P5') // =&gt; 'P4'
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">distance</span> (<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> (b) =&gt; distance(a, b)
  <span class="hljs-keyword">const</span> pa = asPitch(a)
  <span class="hljs-keyword">const</span> pb = asPitch(b)
  <span class="hljs-keyword">const</span> i = substr(pa, pb)
  <span class="hljs-built_in">console</span>.log(a, b, pa, pb, i)</pre></div>
        
      
        
        <p>if a and b are in array notation, no conversion back</p>

        
          <div class='highlight'><pre>  <span class="hljs-keyword">return</span> a === pa &amp;&amp; b === pb ? i : toIvlStr(i)
}

<span class="hljs-comment">/**
 * An alias for `distance`
 * @function
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> dist = distance
<span class="hljs-comment">/**
 * An alias for `distance`
 * @function
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> interval = distance</pre></div>
        
      
        
        <h2 id="3-lists">3. Lists</h2>

        
      
        
        <p>items can be separated by spaces, bars and commas</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> SEP = <span class="hljs-regexp">/\s*\|\s*|\s*,\s*|\s+/</span>
<span class="hljs-comment">/**
 * Split a string by spaces (or commas or bars). Always returns an array, even if its empty
 * @param {String|Array|Object} source - the thing to get an array from
 * @return {Array} the object as an array
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asArr</span> (<span class="hljs-params">src</span>) </span>{
  <span class="hljs-keyword">return</span> isArr(src) ? src
    : <span class="hljs-keyword">typeof</span> src === <span class="hljs-string">'string'</span> ? src.trim().split(SEP)
    : (src === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> src === <span class="hljs-string">'undefined'</span>) ? []
    : [ src ]
}

<span class="hljs-comment">/**
 * Map a list with a function
 *
 * Can be partially applied.
 *
 * @param {Function}
 * @param {String|Array}
 * @return {Array}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span> (<span class="hljs-params">fn, list</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span> ? map(fn)(list) : (l) =&gt; asArr(l).map(fn)
}

<span class="hljs-comment">/**
 * Filter a list with a function
 *
 * Can be partially applied.
 *
 * @param {Function}
 * @param {String|Array}
 * @return {Array}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span> (<span class="hljs-params">fn, list</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span> ? filter(fn)(list) : (l) =&gt; asArr(l).filter(fn)
}</pre></div>
        
      
        
        <h4 id="transform-lists-in-array-notation">Transform lists in array notation</h4>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">const</span> listToStr = (v) =&gt; isPitch(v) ? toPitchStr(v) : isArr(v) ? v.map(toPitchStr) : v

<span class="hljs-comment">/**
 * Decorates a function to work with lists in pitch array notation
 * @function
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> listFn = (fn) =&gt; (src) =&gt; {
  <span class="hljs-keyword">const</span> param = asArr(src).map(asPitch)
  <span class="hljs-keyword">const</span> result = fn(param)
  <span class="hljs-keyword">return</span> listToStr(result)
}</pre></div>
        
      
        
        <h4 id="transpose-lists">Transpose lists</h4>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Create an harmonizer: a function that given a note returns a list of notes.
 *
 * @function
 * @param {String|Array} list
 * @return {Function}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> harmonizer = (list) =&gt; (pitch) =&gt; {
  <span class="hljs-keyword">return</span> listFn((list) =&gt; list.map(transpose(pitch || <span class="hljs-string">'P1'</span>)).filter(id))(list)
}

<span class="hljs-comment">/**
 * Harmonizes a list with a pitch
 *
 * @function
 * @param {String|Array} list
 * @param {String|Pitch} pitch
 * @return {Array}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> harmonize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">list, pitch</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span> ? harmonizer(list)(pitch) : harmonizer(list)
}</pre></div>
        
      
        
        <h4 id="ranges">Ranges</h4>

        
      
        
        <p>ascending range</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> ascR = (b, n) =&gt; { <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = []; n-- ; a[n] = n + b ); <span class="hljs-keyword">return</span> a; }</pre></div>
        
      
        
        <p>descending range</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> descR = (b, n) =&gt; { <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = []; n-- ; a[n] = b - n ) ; <span class="hljs-keyword">return</span> a; }

<span class="hljs-comment">/**
 * Create a range. It works with numbers or note names
 * @function
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">range</span> (<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-keyword">const</span> ma = isNum(a) ? a : midi(a)
  <span class="hljs-keyword">const</span> mb = isNum(b) ? b : midi(b)
  <span class="hljs-keyword">return</span> ma === <span class="hljs-literal">null</span> || mb === <span class="hljs-literal">null</span> ? []
    : ma &lt; mb ? ascR(ma, mb - ma + <span class="hljs-number">1</span>) : descR(ma, ma - mb + <span class="hljs-number">1</span>)
}

<span class="hljs-comment">/**
 * Create a note range
 * @function
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noteRange</span> (<span class="hljs-params">fn, a, b</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> (a, b) =&gt; noteRange(fn, a, b)
  <span class="hljs-keyword">return</span> range(a, b).map(fn).filter((x) =&gt; x !== <span class="hljs-literal">null</span> )
}

<span class="hljs-comment">/**
 * Create a range of chromatic notes
 * @function
 * @example
 * tonal.chromatic('C2', 'E2') // =&gt; ['C2', 'Db2', 'D2', 'Eb2', 'E2']
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> chromatic = noteRange(fromMidi)</pre></div>
        
      
        
        <h4 id="cycle-of-fifths">Cycle of fifths</h4>

        
          <div class='highlight'><pre>
<span class="hljs-comment">/**
 * Transpose a tonic a number of perfect fifths.
 * @function
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fifthsFrom</span> (<span class="hljs-params">t, n</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> fifthsFrom(t)(n)
  <span class="hljs-keyword">return</span> (n) =&gt; tr(t, ivlArr(n, <span class="hljs-number">0</span>))
}</pre></div>
        
      
        
        <h4 id="sort-lists">Sort lists</h4>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">const</span> objHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">p</span>) </span>{
  <span class="hljs-keyword">if</span> (!p) <span class="hljs-keyword">return</span> -<span class="hljs-literal">Infinity</span>
  <span class="hljs-keyword">const</span> f = p[<span class="hljs-number">1</span>] * <span class="hljs-number">7</span>
  <span class="hljs-keyword">const</span> o = isNum(p[<span class="hljs-number">2</span>]) ? p[<span class="hljs-number">2</span>] : -<span class="hljs-built_in">Math</span>.floor(f / <span class="hljs-number">12</span>) - <span class="hljs-number">10</span>
  <span class="hljs-keyword">return</span> f + o * <span class="hljs-number">12</span>
}

<span class="hljs-keyword">const</span> ascComp = (a, b) =&gt; objHeight(a) - objHeight(b)
<span class="hljs-keyword">const</span> descComp = (a, b) =&gt; -ascComp(a, b)

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sort</span> (<span class="hljs-params">comp, list</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> sort(comp)(list)
  <span class="hljs-keyword">const</span> fn = comp === <span class="hljs-literal">true</span> || comp === <span class="hljs-literal">null</span> ? ascComp
    : comp === <span class="hljs-literal">false</span> ? descComp : comp
  <span class="hljs-keyword">return</span> listFn((arr) =&gt; arr.sort(fn))
}</pre></div>
        
      
        
        <p>Fin.</p>

        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
